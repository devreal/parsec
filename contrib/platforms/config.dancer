#!/bin/bash

if [ "x$USER" = "xbosilca" ]; then
#  CUDA_DIR="/opt/cuda-5.0.7/cuda"
#  HWLOC_DIR="/home/bosilca/opt/"
#  MPI_DIR="/home/bosilca/opt/mpi"
  USER_OPTIONS+=" -DDPLASMA_PRECISIONS=d"

elif [ "x${USER}" = "xmfaverge" ]; then
  # if [ "x${CC}" = "xgcc" ]; then
  #     DSPARSE="-DPARSEC_WITH_SPARSE=ON -DPASTIX_DIR=/home/mfaverge/opt/pastix-dbg -DSCOTCH_DIR=/opt/scotch-gf"
  # else
  #     DSPARSE="-DPARSEC_WITH_SPARSE=ON -DPASTIX_DIR=/home/mfaverge/opt/pastix-intel -DSCOTCH_DIR=/opt/scotch"
  # fi
  #USER_OPTIONS+=" -DPARSEC_DIST_WITH_MPI=OFF"
  USER_OPTIONS+=" -DPARSEC_GPU_WITH_CUDA=ON"
  USER_OPTIONS+=" -DDPLASMA_PRECISIONS=d"
  if [ "$CC" = "gcc" ]; then
      PLASMA_DIR=${PLASMA_DIR:="/opt/plasma-gcc"}
  else
      PLASMA_DIR=${PLASMA_DIR:="/opt/plasma-intel"}
  fi
elif [ "x$USER" = "xrhoque" ]; then
    CC="/opt/gcc/5.1/bin/gcc"
    CXX="/opt/gcc/5.1/bin/c++"
    FC="/opt/gcc/5.1/bin/gfortran"
    PLASMA_DIR="/opt/plasma-2.7.1-gcc-5.1"
    MPI_DIR="/opt/ompi/1.8.8/"
elif [ "x$USER" = "xdgenet" ]; then
    USER_OPTIONS+=" -DDPLASMA_PRECISIONS=d"
    HWLOC_DIR="/opt/hwloc/current"
    #MPI_DIR="/opt/ompi/2.0.1/"
    #CC=gcc
    #CXX=g++
    #FC=gfortran
    #PLASMA_DIR="/opt/plasma-gcc"


    while [ $# -ge 1 ]; do
        # MPI is detected after loading a module
        if [ "x$1" = "xICC" ]; then
            CC=icc
            CXX=icpc
            FC=ifort
            PLASMA_DIR="/opt/plasma-intel"
        elif [ "x$1" = "xGCC" ]; then
            CC=gcc
            CXX=g++
            FC=gfortran
            PLASMA_DIR="/opt/plasma-gcc"
        else
            USER_OPTIONS+=" -D$1"
        fi
        shift
    done
    USER_OPTIONS+=" -DBUILD_SUMMA=ON"

elif [ "x$USER" = "xYOURSELF" ]; then
    PLASMA_DIR="SOMEWHERE"
    USER_OPTIONS+="-DPARSEC_OPTION=ON"
fi

echo "### Defaults for Dancer machine (intel-NV Linux cluster)"
# Do not set the compiler flags (CC, CXX, FC) and the MPI flags (MPI_DIR)
# CUDA (detected via nvcc), PAPI (detected via papi_avail), HWLOC (detected
# via hwloc-ls) nor the PYTHON_EXECUTABLE
# if you want the default detection to work.
INSTALL_PREFIX=${INSTALL_PREFIX:="$PWD"}
HWLOC_DIR=${HWLOC_DIR:="/opt/hwloc"}
GTG_DIR=${GTG_DIR:="/opt/gtg"}
OMEGA_DIR=${OMEGA_DIR:="/opt/omega"}
PLASMA_DIR=${PLASMA_DIR:="/opt/plasma"}
TESTCMD="-DMPI_TEST_CMD=\"mpirun -x LD_LIBRARY_PATH -map-by node\" -DSHM_TEST_CMD=\"mpirun -x LD_LIBRARY_PATH -map-by node -np 1\""

. $(dirname $0)/config.inc
guess_defaults
run_cmake $*

